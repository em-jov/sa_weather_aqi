<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sarajevo - Weather and Air Quality</title>
    <style><%= style %></style>
  </head>
  <body>
    <header>
      <h1>Sarajevo</h1>
      <p>Last update on <%= last_update %>.</p>
      <nav>
          <ul>
            <li><a href="#weather">Current weather</a></li>
            <li><a href="#city-aqi">City AQI</a></li>
            <li><a href="#stations-aqi">Stations AQI</a></li>
          </ul>
      </nav>
    </header>
    <main class="content">
      <div id="weather" class="section">
        <h1><%= current_weather[:currenttemp] %>°C</h1>
        <img src="https://openweathermap.org/img/wn/<%= current_weather[:icon] %>@2x.png" />
        <p id="weather_description"><%= current_weather[:description] %></p>
        <p class="flex">
          <span class="temp">Feels like: <%= current_weather[:feelslike] %>°C</span>
          <span>Humidity: <%= current_weather[:humidity] %>%</span>
        </p>
        <p class="flex">
          <span class="rain">Rain: <%= current_weather[:rain] %>mm</span>
          <span>Wind: <%= current_weather[:wind] %>km/h</span>
        </p>
        <p class="flex">
          <span>Sunrise: <%= current_weather[:sunrise] %></span>
          <span>Sunset: <%= current_weather[:sunset] %></span>
        </p>
      </div>

      <div id="city-aqi" class="section section-odd">
        <h2 class="<%= pollutants[:aqi][:class] %>">AQI: <%= pollutants[:aqi][:class].gsub('_', ' ') %> (<%= pollutants[:aqi][:value] %>)  </h2>
        <b>Who Needs to be Concerned?</b>
        <p><%= pollutants[:aqi][:who] %></p>
        <br>
        <b>What Should I Do?</b>
        <p><%= pollutants[:aqi][:advisory] %></p>
        <br>
        <table class="centered-table">
          <tr>
            <th>SO<sub>2</sub></th>
            <th>NO<sub>2</sub></th>
            <th>CO</th>
            <th>O<sub>3</sub></th>
            <th>PM<sub>10</sub></th>
            <th>PM<sub>2.5</sub></th>
          </tr>
          <tr>
            <td class="<%= pollutants[:so2][:class] %>"><%= pollutants[:so2][:value] %></td>
            <td class="<%= pollutants[:no2][:class] %>"><%= pollutants[:no2][:value] %></td>
            <td class="<%= pollutants[:co][:class] %>"><%= pollutants[:co][:value] %></td>
            <td class="<%= pollutants[:o3][:class] %>"><%= pollutants[:o3][:value] %></td>
            <td class="<%= pollutants[:pm10][:class] %>"><%= pollutants[:pm10][:value] %></td>
            <td class="<%= pollutants[:pm2_5][:class] %>"><%= pollutants[:pm2_5][:value] %></td>
          </tr>
        </table>
      </div>

      <div id="stations-aqi" class="section">  
        <h3> Latest AQI by monitoring stations</h3>
        <table class="centered-table">
          <tr>
            <th>Station</th>
            <th>AQI</th>
            <th>SO<sub>2</sub></th>
            <th>NO<sub>2</sub></th>
            <th>CO</th>
            <th>O<sub>3</sub></th>
            <th>PM<sub>10</sub></th>
            <th>PM<sub>2.5</sub></th>
          </tr>
          <% latest_aqi_values.each do |station, pollutants| %>
            <tr>
              <td><%= station %></td>
              <% %i[aqi so2 no2 co o3 pm10 pm2_5].each do |pollutant| %>
              <% if pollutants.key?(pollutant)%>
                <td class="<%= pollutants[pollutant][:class] %>">
                  <%= pollutants[pollutant][:value] %>
                </td>   
              <% else %>
                <td></td>
              <% end %>         
              <% end %>
            </tr>
          <% end %>
        </table>
        <br><br>
        <small>Data provided by <a href="https://www.fhmzbih.gov.ba/latinica/ZRAK/AQI-satne.php">Federal Hydro-Meteorological Institute</a></small>
      </div>

    </main>
    <footer>
        <small>This website doesn't use cookies.</small>
    </footer>
  </body>
</html>