<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sarajevo - Weather and Air Quality</title>
    <style><%= style %></style>
  </head>
  <body>

    <header>
      <h1>Sarajevo</h1>
      <p><%= I18n.t(:last_update) %>: <br> <%= last_update %></p>
      <% if I18n.locale == :bs %>
        <span class="lang_off">bs</span> / <a href="en/index.html">en</a>
      <% else %>
        <a href="../index.html">bs</a> / <span class="lang_off">en</span>
      <% end %>
    </header>

    <main class="container">

      <div id="weather" class="section">
        <h2><%= I18n.t(:current_weather) %></h2>
        <% if current_weather.has_key?(:error) %>
          <p><%= current_weather[:error][I18n.locale] %></p>
        <% else %> 
          <h1><%= current_weather[:currenttemp] %>째C</h1>
          <span class="temp"><%= I18n.t(:feels_like) %>: <%= current_weather[:feelslike] %>째C</span><br>
          <img src="https://openweathermap.org/img/wn/<%= current_weather[:icon] %>@2x.png" />
          <p id="weather_description"><%= current_weather[:description] %></p>
          <div class="other_info">
            <span><%= I18n.t(:humidity) %>: <%= current_weather[:humidity] %>%</span>
            <span class="rain"><%= I18n.t(:rain) %>: <%= current_weather[:rain] %>mm</span>
            <span><%= I18n.t(:wind) %>: <%= current_weather[:wind] %>km/h</span>
            <span><%= I18n.t(:sunrise) %>: <%= current_weather[:sunrise] %></span>
            <span><%= I18n.t(:sunset) %>: <%= current_weather[:sunset] %></span>
          </div>

          <% if forecast_today != [] %>
          <div id="today_forecast">
            <p><%= I18n.t(:weather_forecast_today) %></p>
            <div id="today_forecast_table">
              <table>
                <% forecast_today.each do |interval| %>

                      <td >
                        <p><%= interval[:time] %></p>
                        <img src="https://openweathermap.org/img/wn/<%= interval[:icon] %>.png" title="<%= interval[:description] %>"/><br>
                        <span class="temp"><%= interval[:temp] %>째C</span><br>
                        <% if interval[:rain] != 0 %>
                          <div class="small"><span class="rain"><%= interval[:rain] %>mm</span></div>
                        <% else %>
                          <div class="small">&nbsp</div>
                        <% end %>
                      </td>

                <% end %>
              </table>
            </div>
          </div>
          <% end %>


        <% end %>
      </div>

      <div id="air" class="section">
        <h2><%= I18n.t(:aqi_quality_index) %></h2>
        <h3 class="<%= city_pollutants[:aqi][:class] %>"><%= I18n.t("#{city_pollutants[:aqi][:class]}.name") %> (<%= city_pollutants[:aqi][:value] %>)  </h3>

        <table id="city_aqi" class="centered-table">
          <tr>
            <th>SO<sub>2</sub></th>
            <th>NO<sub>2</sub></th>
            <th>CO</th>
            <th>O<sub>3</sub></th>
            <th>PM<sub>10</sub></th>
            <th>PM<sub>2.5</sub></th>
          </tr>
          <tr>
            <td class="<%= city_pollutants[:so2][:class] %>"><%= city_pollutants[:so2][:value] %></td>
            <td class="<%= city_pollutants[:no2][:class] %>"><%= city_pollutants[:no2][:value] %></td>
            <td class="<%= city_pollutants[:co][:class] %>"><%= city_pollutants[:co][:value] %></td>
            <td class="<%= city_pollutants[:o3][:class] %>"><%= city_pollutants[:o3][:value] %></td>
            <td class="<%= city_pollutants[:pm10][:class] %>"><%= city_pollutants[:pm10][:value] %></td>
            <td class="<%= city_pollutants[:pm2_5][:class] %>"><%= city_pollutants[:pm2_5][:value] %></td>
          </tr>
        </table>

        <div id="health_advisory">
          <% if city_pollutants[:aqi][:who] != "x" %>
            <h4><%= I18n.t(:who) %></h4>
            <p><%= I18n.t("#{city_pollutants[:aqi][:class]}.who") %></p>
          <% end %>
          <h4><%= I18n.t(:what_to_do) %></h4>
          <div id="advisory"><%= I18n.t("#{city_pollutants[:aqi][:class]}.advisory") %></div>
        </div>
      </div>

      <div id="stations-aqi" class="section">  
        <h2><%= I18n.t(:latest_aqi_data_ms) %></h2>
        <table id="stations_aqi" class="centered-table">
          <tr>
            <th><%= I18n.t(:aqi) %></th>
            <th><%= I18n.t(:station) %> </th>
            <th>SO<sub>2</sub></th>
            <th>NO<sub>2</sub></th>
            <th>CO</th>
            <th>O<sub>3</sub></th>
            <th>PM<sub>10</sub></th>
            <th>PM<sub>2.5</sub></th>
          </tr>
          <% stations_pollutants_aqi.each do |station, values| %>
            <tr>
              <td class="<%= values[:aqi][:class] %>">
                  <%= values[:aqi][:value] %>
                </td>  
              <td><%= values[:name] %></td>
              <% %i[so2 no2 co o3 pm10 pm2_5].each do |pollutant| %>
              <% if values.key?(pollutant)%>
                <td class="<%= values[pollutant][:class] %>">
                  <%= values[pollutant][:value] %>
                </td>   
              <% else %>
                <td></td>
              <% end %>         
              <% end %>
            </tr>
          <% end %>
        </table>
        <br><br>
        <div class="small"><%= I18n.t(:data_provided_by) %>  <a href="https://www.fhmzbih.gov.ba/latinica/ZRAK/AQI-satne.php"><%= I18n.t(:fhmz) %></a></div>
      </div>

      <div id="weather_forecast" class="section">
        <h2><%= I18n.t(:weather_forecast) %></h2>
        <% if weather_forecast.has_key?(:error) %>
          <p><%= weather_forecast[:error][I18n.locale] %></p>
        <% else %>  
        <div id="forecast_table">
          <table class="centered-table" cellspacing="0">
            <tr>
              <td class="forecast_day sticky-col first-col"></td>
              <td><%= I18n.localize(Time.parse('01:00'), format: :hm) %></td>
              <td><%= I18n.localize(Time.parse('04:00'), format: :hm) %></td>
              <td><%= I18n.localize(Time.parse('07:00'), format: :hm) %></td>
              <td><%= I18n.localize(Time.parse('10:00'), format: :hm) %></td>
              <td><%= I18n.localize(Time.parse('13:00'), format: :hm) %></td>
              <td><%= I18n.localize(Time.parse('16:00'), format: :hm) %></td>
              <td><%= I18n.localize(Time.parse('19:00'), format: :hm) %></td>
              <td><%= I18n.localize(Time.parse('22:00'), format: :hm) %></td>
              </div>
            </tr>
            <% first = true %>
            <% weather_forecast.each do |day, values| %>
            <tr class="border_bottom">
              <td class="forecast_day sticky-col first-col"><%= day %></td>
              <% if first == true %>
                <% to_skip = 8 - values.length %>
                <% if to_skip > 0 %>
                  <td colspan="<%= to_skip %>"></td>
                <% end %>
              <% end %>
              <% values.each do |value| %>
              <td>
                <img src="https://openweathermap.org/img/wn/<%= value[:icon] %>.png" title="<%= value[:description] %>"/><br>
                <span class="temp"><%= value[:temp] %>째C</span><br>
                <% if value[:rain] != 0 %>
                <div class="small"><span class="rain"><%= value[:rain] %>mm</span></div>
                <% else %>
                <div class="small">&nbsp</div>
                <% end %>
              </td>
              <% end %>
            </tr>
            <% first = false %>
            <% end %>
          </table>
        </div> 
        <br>
        <div class="small"><%= I18n.t(:data_provided_by) %>  <a href="https://openweathermap.org/city/3191281">OpenWeather</a></div>
        <% end %>
      </div>

    </main>

    <footer>
        <div class="small"><%= I18n.t(:no_cookies) %><br>
        <a href="/feed.json">API</a></div>
    </footer>

  </body>
</html>